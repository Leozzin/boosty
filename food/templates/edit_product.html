{% extends "base.html" %}
{% load static %}
{% block styles %}
<link href="{% static 'css/eshop.css' %}" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bs-stepper/dist/css/bs-stepper.min.css">
{% endblock %}
{% block main_container %}
<div class="messages">
    {% if messages %} {% for message in messages %}
    <p class="text-center alert  alert-success {{ message.tags }}">
        {{ message }}
    </p>
    {% endfor %} {% endif %}
</div>
<div class="row justify-content-center">
    <div class="col-8 col-md-8 col-sm-12">
        <div class="mb-5 p-4 bg-white shadow-sm">
            <h3>Edit Product</h3>
            <div id="stepper1" class="bs-stepper linear">
                <div class="bs-stepper-header" role="tablist">
                    <div class="step active" data-target="#test-l-1">
                        <button type="button" class="step-trigger" role="tab" id="stepper1trigger1" aria-controls="test-l-1" aria-selected="true">
                            <span class="bs-stepper-circle">1</span>
                            <span class="bs-stepper-label">Step 1</span>
                        </button>
                    </div>
                    <div class="bs-stepper-line"></div>
                    <div class="step" data-target="#test-l-2">
                        <button type="button" class="step-trigger" role="tab" id="stepper1trigger2" aria-controls="test-l-2" aria-selected="false" disabled="disabled">
                            <span class="bs-stepper-circle">2</span>
                            <span class="bs-stepper-label">Step 2</span>
                        </button>
                    </div>
                    <div class="bs-stepper-line"></div>
                    <div class="step" data-target="#test-l-3">
                        <button type="button" class="step-trigger" role="tab" id="stepper1trigger3" aria-controls="test-l-3" aria-selected="false" disabled="disabled">
                            <span class="bs-stepper-circle">3</span>
                            <span class="bs-stepper-label">Step 3</span>
                        </button>
                    </div>
                </div>
                <div class="bs-stepper-content">
                    <form method="POST" action="{% url 'eshop_edit' p=product.id %}" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div id="test-l-1" role="tabpanel" class="bs-stepper-pane active dstepper-block" aria-labelledby="stepper1trigger1">
                            <div class="form-row">
                                <div class="col">
                                    <label for="nameInput">Name</label>
                                    <input name="product" required value="{{product.name}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                                <div class="col">
                                    <label for="nameInput">Producer</label>
                                    <input name="producer" required value="{{product.owner}}" type="text" class="form-control" id="nameInput" placeholder="Enter producer name">
                                </div>
                                <div class="col">
                                    <label for="barcodeInput">Product barcode</label>
                                    <input name="barcode" required value="{{product.barcode}}" type="text" class="form-control" id="barcodeInput" placeholder="Enter product barcode">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <label for="nameInput">Category</label>
                                    <select required id="categorySelect" name="category" class="form-control">
                                        <option selected>Select Category...</option>
                                        <option value="slimming">Slimming</option>
                                        <option value="allergy">Allergy</option>
                                        <option value="beauty">Beauty</option>
                                        <option value="food">Food</option>
                                        <option value="healthy">Healthy products</option>
                                        <option value="supplements">Food supplements</option>
                                    </select>
                                </div>
                                <div class="col">
                                    <label for="subCategory">Sub Category</label>
                                    <select required class="form-control" name="sub_category" id="subCategory"></select>
                                </div>
                                <div class="col">
                                    <label for="nameInput">Weight</label>
                                    <input required name="weight" value="{{productd.weight}}" type="text" class="form-control" id="nameInput" placeholder="Enter product weight">
                                </div>
                                <div class="col">
                                    <label for="barcodeInput">Quantity</label>
                                    <input required name="quantity" value="{{product.quantity}}" type="text" class="form-control" id="barcodeInput" placeholder="Enter product quantity">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <label for="nameInput">System manuel</label>
                                    <input required name="system_manuel" value="{{productd.usage}}" type="text" class="form-control" id="nameInput" placeholder="Enter system manuel">
                                </div>
                                <div class="col">
                                    <label for="nameInput">Recommender</label>
                                    <input required name="recommend" value="{{product.recommender}}" type="text" class="form-control" id="nameInput" placeholder="{{product.recommender}}">
                                </div>
                                <div class="col">
                                    <label for="barcodeInput">Product Ingredients</label>
                                    <input required name="ingredients" value="{{product.ingredients}}" type="text" class="form-control" id="barcodeInput" placeholder="Enter product ingredients">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <label for="nameInput">Price</label>
                                    <input required name="price" type="text" value="{{product.price}}" class="form-control" id="nameInput" placeholder="Enter product price">
                                </div>
                                <div class="col">
                                    <label for="nameInput">Properties</label>
                                    <input required name="properties" value="{{productd.properties}}" type="text" class="form-control" id="nameInput" placeholder="Enter product properties">
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary mt-3" onclick="stepper1.next()">Next</button>
                        </div>
                        <div id="test-l-2" role="tabpanel" class="bs-stepper-pane" aria-labelledby="stepper1trigger2">
                            <div class="form-row">
                                <div class="col">
                                    <label for="nameInput">Calories</label>
                                    <input required name="calories" value="{{productd.calories_energy}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                                <div class="col">
                                    <label for="nameInput">Lipid Energy(Kal)</label>
                                    <input required name="lipid_energy" value="{{productd.lipid_energy}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                                <div class="col">
                                    <label for="barcodeInput">Fat(100/g)</label>
                                    <input required name="fat" value="{{productd.fat}}" type="text" class="form-control" id="barcodeInput" placeholder="Enter product barcode">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <label for="nameInput">Satureted Fat (100/g)</label>
                                    <input required name="saturated_fat" value="{{productd.saturated_fat}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                                <div class="col">
                                    <label for="nameInput">Sodium (100/g)</label>
                                    <input required name="sodium" value="{{productd.sodium}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                                <div class="col">
                                    <label for="barcodeInput">Salt (100/g)</label>
                                    <input required name="salt" value="{{productd.salt}}" type="text" class="form-control" id="barcodeInput" placeholder="Enter product barcode">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <label for="nameInput">Sugar (100/g)</label>
                                    <input required name="sugar" value="{{productd.sugar}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                                <div class="col">
                                    <label for="nameInput">Protein (100/g)</label>
                                    <input required name="protein" value="{{productd.protein}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                                <div class="col">
                                    <label for="barcodeInput">Calcium (100/g)</label>
                                    <input required name="calcium" value="{{productd.calcium}}" type="text" class="form-control" id="barcodeInput" placeholder="Enter product barcode">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <label for="nameInput">Iron (100/g)</label>
                                    <input required name="iron" value="{{productd.iron}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                                <div class="col">
                                    <label for="nameInput">Fiber (100/g)</label>
                                    <input required name="fiber" value="{{productd.fiber}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                                <div class="col">
                                    <label for="nameInput">Glucides (100/g)</label>
                                    <input required name="glucides" value="{{productd.glucides}}" type="text" class="form-control" id="nameInput" placeholder="Enter product name">
                                </div>
                            </div>
                            <div class="mt-3">
                                <button type="button" class="btn btn-primary" onclick="stepper1.previous()">Previous</button>
                                <button type="button" class="btn btn-primary" onclick="stepper1.next()">Next</button>
                            </div>
                        </div>
                        <div id="test-l-3" role="tabpanel" class="bs-stepper-pane text-center" aria-labelledby="stepper1trigger3">
                            <div class="mt-4 wi-400">
                                <div class="input-group mb-3">
                                    <div class="custom-file">
                                        <label class="custom-file-label" for="inputGroupFile02">Choose File</label>
                                        <input name="product_image" value="{{product.image.url}}" id="imageUpload" type="file" class="custom-file-input" id="inputGroupFile02">
                                    </div> <br>
                                </div>
                                <small class="text-center text-success" id="imageFileName"></small>
                                <div class="progress mt-2">
                                    <div id="progressBar" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary mt-5" onclick="stepper1.previous()">Previous</button>
                            <button type="submit" class="btn btn-primary mt-5">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bs-stepper/dist/js/bs-stepper.min.js"></script>
<script>
var stepper1

document.addEventListener('DOMContentLoaded', function() {
    stepper1 = new Stepper(document.querySelector('#stepper1'))

    var btnNextList = [].slice.call(document.querySelectorAll('.btn-next-form'))
    var inputMailForm = document.getElementById('inputMailForm')
    var inputPasswordForm = document.getElementById('inputPasswordForm')
});
</script>
<script type="text/javascript">
let imageUpload = document.querySelector("#imageUpload");
let progressBar = document.querySelector("#progressBar");

imageUpload.addEventListener("change", function(e) {
    var done = false;
    var value = 0;
    //document.getElementById('imageFileName').innerText = "File Uploaded";
    setTimeout(function() {
        for (let i = 0; i <= 100; i += 20) {
            progressBar.style.width = `${i}%`;
            progressBar.innerHTML = `Image uploaded successfuly!`;
        }
    }, 1000);
});
</script>
<script type="text/javascript">
let categorySelect = document.getElementById("categorySelect");
/*
window.addEventListener("load", function(e) {
})
*/
let l = Object.values(categorySelect.options);
let d = "{{category}}";
console.log(d);
l.forEach(function(elm) {
    if (elm.value == d) {
        elm.selected = true;
    }
})
let subCategories = {
    "slimming": [
        "appetite​ suppressant",
        "athletics diets",
        "slimming diet",
        "drainage and water retention",
        "anti-aging",
        "cellulite",
    ],
    "allergy": ["gluten free", "l​actose intolerance"],
    "beauty": ["vegetable oil", "essential oils"],
    "diseases": [
        "blood sugar regulator",
        "hypertension",
        "cholesterol",
        "diabetes",
        "constipation",
        "gout disease",
        "cardiovascular Disease",
        "obesity"
    ],
    "supplements": [
        "nutritional supplement",
        "organic products",
        "minerals and trace elements",
        "immune system",
        "organic in​ fusion",
        "memory",
        "kids",
        "elderly subjects",
        "fertility and breastfeeding",
        "stress and insomnia",
        "tonicity and vitality",
        "circulation, heavy legs",
    ],
    "healthy": ["healthy"],
};

function updateSelectOptions(key, elm) {
    $("#subCategory").empty(); // remove all select options
    subCategories[key].forEach(function(val) {
        let opt = document.createElement("option");
        opt.setAttribute("value", val);
        opt.innerText = val;
        elm.add(opt);
    })
};

let sC = document.getElementById("subCategory");
let op = document.createElement("option");
let subVal = "{{product.category.subcategory_set.first}}"
op.setAttribute("value", subVal)
op.innerText = subVal;
sC.add(op);


categorySelect.addEventListener("change", function(event) {
    let subCategory = document.getElementById("subCategory");
    let selectValue = categorySelect.options[categorySelect.selectedIndex].value;
    console.log(selectValue)
    updateSelectOptions(selectValue, subCategory);
})
</script>
{% endblock %}